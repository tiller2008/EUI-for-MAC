Award_Window_Flag1=0;sPlayer1=""sLink1=""Award_Window_Flag2=0;sPlayer2=""sLink2=""Award_Window_Flag3=0;sPlayer3=""SLink3=""Award_Window_Flag4=0;sPlayer4=""SLink4=""sPlayer5=""SLink5=""ItemHolder=""WebDKP_RarityTable={[0]=-1,[1]=0,[2]=1,[3]=2,[4]=3,[5]=4}function WebDKP_Loot_Taken(a)if a~=ItemHolder then if WebDKP_Options["AutofillEnabled"]==0 then return end;local b,c;local d,e,f,g=string.find(a,WebDKP.translations.FORMAT_FIND_OTHER_ITEM_LOOT)if f then if f==WebDKP.translations.FORMAT_FIND_PLAYER_SELF then b=UnitName("player")else b=f end;c=g end;if c and b then local h,i,g=WebDKP_GetItemInfo(c)if WebDKP_ShouldIgnoreItem(i)then return end;if i==WebDKP_lastBidItem or i==WebDKP_bidItem then WebDKP_lastBidItem=""return end;local j=WebDKP_RarityTable[h]local k=nil;if j<WebDKP_Options["AutofillThreshold"]then return end;WebDKP_AwardItem_FrameItemName:SetText(i)if WebDKP_Loot~=nil then k=WebDKP_Loot[i]if k~=nil then WebDKP_AwardItem_FrameItemCost:SetText(k)else WebDKP_AwardItem_FrameItemCost:SetText("")end end;WebDKP_SelectPlayerOnly(b)if WebDKP_Options["AutoAwardEnabled"]==1 then if k~=nil then WebDKP_ShowAwardFrame("授予 "..b.." "..c.." ,DKP: "..k.."? \r\n (下方输入dkp, 仅限正数,百分比值同样工作 (50%)",k,c,b)WebDKP_AwardFrameCost:SetText(k)else WebDKP_ShowAwardFrame("授予 "..b.." "..c.."? \r\n (下方输入dkp, 仅限正数,百分比值同样工作 (50%)",nil,c,b)end end end;ItemHolder=a end end;function WebDKP_ShowAwardFrame(l,k,m,b)PlaySound(850)if Award_Window_Flag1==0 then WebDKP_AwardFrame:Show()WebDKP_AwardFrameTitle:SetText(l)if k~=nil then WebDKP_AwardFrameCost:SetText(k)else WebDKP_AwardFrameCost:SetText("")end;sPlayer1=b;sLink1=m;Award_Window_Flag1=1 elseif Award_Window_Flag1==1 and Award_Window_Flag2==0 then WebDKP_AwardFrame2:Show()WebDKP_AwardFrame2Title:SetText(l)if k~=nil then WebDKP_AwardFrame2Cost:SetText(k)else WebDKP_AwardFrame2Cost:SetText("")end;Award_Window_Flag2=1;sLink2=m;sPlayer2=b elseif Award_Window_Flag1==1 and Award_Window_Flag2==1 and Award_Window_Flag3==0 then WebDKP_AwardFrame3:Show()WebDKP_AwardFrame3Title:SetText(l)if k~=nil then WebDKP_AwardFrame3Cost:SetText(k)else WebDKP_AwardFrame3Cost:SetText("")end;Award_Window_Flag3=1;sPlayer3=b;sLink3=m elseif Award_Window_Flag1==1 and Award_Window_Flag2==1 and Award_Window_Flag3==1 and Award_Window_Flag4==0 then WebDKP_AwardFrame4:Show()WebDKP_AwardFrame4Title:SetText(l)if k~=nil then WebDKP_AwardFrame4Cost:SetText(k)else WebDKP_AwardFrame4Cost:SetText("")end;Award_Window_Flag4=1;sPlayer4=b;sLink4=m elseif Award_Window_Flag1==1 and Award_Window_Flag2==1 and Award_Window_Flag3==1 and Award_Window_Flag4==1 then WebDKP_AwardFrame5:Show()WebDKP_AwardFrame5Title:SetText(l)if k~=nil then WebDKP_AwardFrame5Cost:SetText(k)else WebDKP_AwardFrame5Cost:SetText("")end;sPlayer5=b;sLink5=m end end;function WebDKP_AwardItem_Event2(n,o)local k=n;local p=string.find(k,"%%")local q=0;local r=WebDKP_GetTableid()if o==1 then player=sPlayer1;item=sLink1 elseif o==2 then player=sPlayer2;item=sLink2 elseif o==3 then player=sPlayer3;item=sLink3 elseif o==4 then player=sPlayer4;item=sLink4 else player=sPlayer5;item=sLink5 end;WebDKP_SelectPlayerOnly(player)local s=WebDKP_GetSelectedPlayers(1)if p~=nil then k=string.gsub(k,"%%","")k=tonumber(k)q=1 end;if k==nil or k==""then WebDKP_Print("未输入值，因此dkp默认为0")k=0 end;local t=k*-1;t=WebDKP_ROUND(t,2)if q==1 then local u=s[0]["name"]k=k/100*WebDKP_DkpTable[u]["dkp_"..r]*-1;t=WebDKP_ROUND(k,2)end;if s==nil or s==""then WebDKP_Print("没有选择要授予的玩家。")PlaySound(847)else WebDKP_AddDKP(t,item,"true",s)WebDKP_AnnounceAwardItem(t,item,s[0]["name"])WebDKP_UpdateTableToShow()WebDKP_UpdateTable()end end;function WebDKP_AutoFillCost()local v=WebDKP_AwardItem_FrameItemName:GetText()local w=0;local x,y,z,A,B=WebDKP_GetItemInfo(v)local C=WebDKP_Options["ItemLevelMult"]startingBid=WebDKP_GetLootTableCost(v)if startingBid==nil and WebDKP_Options["ItemLevelEquation"]==1 and A~=nil then A=tonumber(A)C=tonumber(C)if A>100 then startingBid=A*C end;w=1 end;if(startingBid==nil or w==1)and WebDKP_Options["SlotLocMult"]==1 and B~=nil then if startingBid==nil then startingBid=A end;if B=="INVTYPE_HEAD"then local D=tonumber(WebDKP_Options["ItemLocMult"]["head"])startingBid=startingBid*D elseif B=="INVTYPE_NECK"then local D=tonumber(WebDKP_Options["ItemLocMult"]["neck"])startingBid=startingBid*D elseif B=="INVTYPE_SHOULDER"then local D=tonumber(WebDKP_Options["ItemLocMult"]["shoulders"])startingBid=startingBid*D elseif B=="INVTYPE_CHEST"or B=="INVTYPE_ROBE"then local D=tonumber(WebDKP_Options["ItemLocMult"]["chest"])startingBid=startingBid*D elseif B=="INVTYPE_WAIST"then local D=tonumber(WebDKP_Options["ItemLocMult"]["waist"])startingBid=startingBid*D elseif B=="INVTYPE_LEGS"then local D=tonumber(WebDKP_Options["ItemLocMult"]["legs"])startingBid=startingBid*D elseif B=="INVTYPE_FEET"then local D=tonumber(WebDKP_Options["ItemLocMult"]["feet"])startingBid=startingBid*D elseif B=="INVTYPE_WRIST"then local D=tonumber(WebDKP_Options["ItemLocMult"]["wrist"])startingBid=startingBid*D elseif B=="INVTYPE_HAND"then local D=tonumber(WebDKP_Options["ItemLocMult"]["hands"])startingBid=startingBid*D elseif B=="INVTYPE_FINGER"then local D=tonumber(WebDKP_Options["ItemLocMult"]["fingers"])startingBid=startingBid*D elseif B=="INVTYPE_TRINKET"then local D=tonumber(WebDKP_Options["ItemLocMult"]["trinkets"])startingBid=startingBid*D elseif B=="INVTYPE_CLOAK"then local D=tonumber(WebDKP_Options["ItemLocMult"]["back"])startingBid=startingBid*D elseif B=="INVTYPE_WEAPONMAINHAND"then local D=tonumber(WebDKP_Options["ItemLocMult"]["mainhand"])startingBid=startingBid*D elseif B=="INVTYPE_SHIELD"then local D=tonumber(WebDKP_Options["ItemLocMult"]["shield"])startingBid=startingBid*D elseif B=="INVTYPE_RELIC"then local D=tonumber(WebDKP_Options["ItemLocMult"]["relic"])startingBid=startingBid*D elseif B=="INVTYPE_RANGED"or B=="INVTYPE_THROWN"or B=="INVTYPE_RANGEDRIGHT"then local D=tonumber(WebDKP_Options["ItemLocMult"]["ranged"])startingBid=startingBid*D elseif B=="INVTYPE_2HWEAPON"then local D=tonumber(WebDKP_Options["ItemLocMult"]["twohand"])startingBid=startingBid*D elseif B=="INVTYPE_WEAPON"then local D=tonumber(WebDKP_Options["ItemLocMult"]["onehanders"])startingBid=startingBid*D elseif B=="INVTYPE_WEAPONOFFHAND"then local D=tonumber(WebDKP_Options["ItemLocMult"]["offhandweapon"])startingBid=startingBid*D elseif B=="INVTYPE_HOLDABLE"then local D=tonumber(WebDKP_Options["ItemLocMult"]["heldoffhand"])startingBid=startingBid*D else startingBid=0 end end;if startingBid~=nil then WebDKP_AwardItem_FrameItemCost:SetText(startingBid)else end end;function WebDKP_AutoFillDKP()if WebDKP_Options["AutofillEnabled"]==0 then return end;local i=WebDKP_AwardDKP_FrameReason:GetText()if WebDKP_Loot~=nil and i~=nil then local k=WebDKP_Loot[i]if k~=nil then WebDKP_AwardDKP_FramePoints:SetText(k)end end end

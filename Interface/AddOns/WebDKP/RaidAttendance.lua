global_raid=""global_startTime=""previous_raid=""previous_starttime=""previous_name=""function WebDKP_RaidLog_ToggleUI()if WebDKP_RaidInfoFrame:IsShown()then WebDKP_RaidInfoFrame:Hide()else WebDKP_RaidInfoFrame:Show()WebDKP_UpdateRaidLogTable()end end;function WebDKP_CharRaidLog_ToggleUI()if WebDKP_CharRaidInfoFrame:IsShown()then WebDKP_CharRaidInfoFrame:Hide()else WebDKP_CharRaidInfoFrame:Show()WebDKP_UpdateCharRaidLogTable()end end;function WebDKP_HandleMouseOverRaidLog(self)local a=self;if WebDKP_RaidInfo~=nil then local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if not WebDKP_RaidInfo[b.." "..e]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)end end end;function WebDKP_HandleMouseOverCharRaidLog(self)local a=self;if WebDKP_CharRaidInfo~=nil then local charname=_G[a:GetName().."CharName"]:GetText()local f=_G[a:GetName().."CharRaidTot"]:GetText()local g=_G[a:GetName().."CharRaidAttended"]:GetText()local h=_G[a:GetName().."CharRaidPercent"]:GetText()if not WebDKP_CharRaidInfo[charname]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)end end end;function WebDKP_HandleMouseLeaveRaidLog(self)local a=self;if WebDKP_RaidInfo~=nil then local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if not WebDKP_RaidInfo[b.." "..e]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_HandleMouseLeaveCharRaidLog(self)local a=self;if WebDKP_CharRaidInfo~=nil then local charname=_G[a:GetName().."CharName"]:GetText()local f=_G[a:GetName().."CharRaidTot"]:GetText()local g=_G[a:GetName().."CharRaidAttended"]:GetText()local h=_G[a:GetName().."CharRaidPercent"]:GetText()if not WebDKP_CharRaidInfo[charname]["selected"]then _G[a:GetName().."Background"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_SelectRaidLogToggle(self)local a=self;if WebDKP_RaidInfo~=nil then if previous_raid~=""and previous_starttime~=""then WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local b=_G[a:GetName().."RaidLocation"]:GetText()local c=_G[a:GetName().."date"]:GetText()local d=_G[a:GetName().."startTime"]:GetText()local e=strjoin(" ",c,d)if WebDKP_RaidInfo[b.." "..e]["selected"]then WebDKP_RaidInfo[b.." "..e]["selected"]=false;_G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)else WebDKP_RaidInfo[b.." "..e]["selected"]=true;_G[a:GetName().."Background"]:SetVertexColor(0.1,0.1,0.9,0.8)end;previous_raid=b;previous_starttime=e;_G["LineLocation"]=_G[a:GetName().."Background"]WebDKP_UpdateAttendedTable(b,e)end end;function WebDKP_SelectCharRaidLogToggle(self)local a=self;if WebDKP_CharRaidInfo~=nil then if previous_name~=nil and previous_name~=""then WebDKP_CharRaidInfo[previous_name]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local charname=_G[a:GetName().."CharName"]:GetText()if WebDKP_CharRaidInfo[charname]["selected"]then WebDKP_CharRaidInfo[charname]["selected"]=false;_G[a:GetName().."Background"]:SetVertexColor(0.2,0.2,0.7,0.5)else WebDKP_CharRaidInfo[charname]["selected"]=true;_G[a:GetName().."Background"]:SetVertexColor(0.1,0.1,0.9,0.8)end;previous_name=charname;_G["LineLocation"]=_G[a:GetName().."Background"]WebDKP_UpdateCharAttendedTable(charname)end end;function WebDKP_SelectAttendeeLogToggle(self)local a=self;if WebDKP_RaidInfo~=nil then if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end;local i=_G[a:GetName().."Attended"]:GetText()if i~=nil then WebDKP_RaidInfoFrameCharChange:SetText(i)end end end;function WebDKP_UpdateRaidLogTable()if WebDKP_RaidInfo~=nil then local j={}local i={}for k,l in pairs(WebDKP_RaidInfo)do countnames=0;if type(l)=="table"then if l["raid"]~=nil and l["date"]~=nil and l["starttime"]~=nil and l["endtime"]~=nil and l["totaltime"]~=nil and l["completedate"]~=nil then tinsert(j,{l["raid"],l["date"],l["starttime"],l["endtime"],l["totaltime"],l["completedate"]})end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollRaidLogFrame)FauxScrollFrame_Update(WebDKP_RaidInfoFrameScrollRaidLogFrame,o,20,20)for q=1,20,1 do local r=getglobal("WebDKP_RaidInfoFrameLine"..q)raidText=getglobal("WebDKP_RaidInfoFrameLine"..q.."RaidLocation")dateText=getglobal("WebDKP_RaidInfoFrameLine"..q.."date")local s=getglobal("WebDKP_RaidInfoFrameLine"..q.."startTime")local t=getglobal("WebDKP_RaidInfoFrameLine"..q.."endTime")local u=getglobal("WebDKP_RaidInfoFrameLine"..q.."totaltime")local v=q+FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollRaidLogFrame)if v<=o then r:Show()raidText:SetText(j[v][1])dateText:SetText(j[v][2])s:SetText(j[v][3])t:SetText(j[v][4])u:SetText(j[v][5])else r:Hide()end end end end;function WebDKP_UpdateCharRaidLogTable()WebDKP_UpdatePlayersInGroup()local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local x=WebDKP_CharRaidInfoFrameApplyFilterDate:GetChecked()if WebDKP_CharRaidInfo~=nil then local j={}if WebDKP_Options["InGroup"]==1 then for k,l in pairs(WebDKP_PlayersInGroup)do if type(l)=="table"then if l["name"]~=nil then if WebDKP_CharRaidInfo[l["name"]]~=nil then tinsert(j,{l["name"],WebDKP_CharRaidInfo[l["name"]]["total_raids"],WebDKP_CharRaidInfo[l["name"]]["raids_attended"],WebDKP_CharRaidInfo[l["name"]]["percent"]})end end end end else local i={}for k,l in pairs(WebDKP_CharRaidInfo)do countnames=0;if type(l)=="table"then if l["total_raids"]~=nil and l["raids_attended"]~=nil and l["percent"]~=nil then tinsert(j,{k,l["total_raids"],l["raids_attended"],l["percent"]})end end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame)FauxScrollFrame_Update(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame,o,25,20)if x then local month,day,year=WebDKP_ApplyDateFilter(w)end;for q=1,23,1 do local r=getglobal("WebDKP_CharRaidInfoFrameLine"..q)nameText=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharName")local y=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidTot")local z=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidAttended")local A=getglobal("WebDKP_CharRaidInfoFrameLine"..q.."CharRaidPercent")local v=q+FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollCharRaidLogFrame)if v<=o then r:Show()local charname=j[v][1]local B=j[v][2]local C=j[v][3]local D=j[v][4]if x and month~=nil then B,C,D=WebDKP_ProcessCharAttendedRaids(month,day,year,charname)end;nameText:SetText(charname)if WebDKP_DkpTable[charname]~=nil and WebDKP_DkpTable[charname]["class"]~=nil then local E=WebDKP_DkpTable[charname]["class"]E=string.upper(E)E=string.gsub(E," ","")if RAID_CLASS_COLORS[E]~=nil then nameText:SetTextColor(RAID_CLASS_COLORS[E]["r"],RAID_CLASS_COLORS[E]["g"],RAID_CLASS_COLORS[E]["b"])end end;y:SetText(B)z:SetText(C)A:SetText(D)else r:Hide()end end end end;function WebDKP_UpdateCharAttendedTable(name)local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local x=WebDKP_CharRaidInfoFrameApplyFilterDate:GetChecked()raidsattended=WebDKP_CharRaidInfo[name]["attended"]local j={}local F=getn(raidsattended)for q=1,F,1 do stringdata=raidsattended[q]attendedholder,raidlocation1,raiddate1=strsplit("&",stringdata)if attendedholder=="1"then if x then local G=WebDKP_CrossCheckDate(raiddate1)if G==true then tinsert(j,{raidlocation1,raiddate1})end else tinsert(j,{raidlocation1,raiddate1})end end end;table.sort(j,function(m,n)if m and n then if m==nil then return 1>0 elseif n==nil then return 1<0 end;if WebDKP_LogSort["way4"]==1 then if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]>n[1]else return m[WebDKP_LogSort["curr4"]]>n[WebDKP_LogSort["curr4"]]end else if m[WebDKP_LogSort["curr4"]]==n[WebDKP_LogSort["curr4"]]then return m[1]<n[1]else return m[WebDKP_LogSort["curr4"]]<n[WebDKP_LogSort["curr4"]]end end end end)local o=getn(j)local p=FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame)FauxScrollFrame_Update(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame,o,25,20)for q=1,23,1 do local r=getglobal("WebDKP_CharRaidInfoFrameLines"..q)locationText=getglobal("WebDKP_CharRaidInfoFrameLines"..q.."RaidLocation")dateText=getglobal("WebDKP_CharRaidInfoFrameLines"..q.."RaidDate")local v=q+FauxScrollFrame_GetOffset(WebDKP_CharRaidInfoFrameScrollAttendedRaidFrame)if v<=o then r:Show()local H=j[v][1]local I=j[v][2]locationText:SetText(H)dateText:SetText(I)else r:Hide()end end end;function WebDKP_UpdateAttendedTable(b,J)nameentries=WebDKP_RaidInfo[b.." "..J]["attended"]table.sort(nameentries,function(K,L)return K<L end)local o=getn(nameentries)local p=FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollAttendeeFrame)FauxScrollFrame_Update(WebDKP_RaidInfoFrameScrollAttendeeFrame,o,25,20)for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)attendedText=getglobal("WebDKP_RaidInfoFrameLines"..q.."Attended")local v=q+FauxScrollFrame_GetOffset(WebDKP_RaidInfoFrameScrollAttendeeFrame)if v<=o then r:Show()local charname=nameentries[v]attendedText:SetText(charname)if WebDKP_DkpTable[charname]~=nil and WebDKP_DkpTable[charname]["class"]~=nil then local E=WebDKP_DkpTable[charname]["class"]E=string.upper(E)E=string.gsub(E," ","")if RAID_CLASS_COLORS[E]~=nil then attendedText:SetTextColor(RAID_CLASS_COLORS[E]["r"],RAID_CLASS_COLORS[E]["g"],RAID_CLASS_COLORS[E]["b"])end end else r:Hide()end end end;function WebDKP_RaidStart()local M=date("%H:%M:%S")local N=date("%Y-%m-%d %H:%M:%S")local O=date("%Y%m%d%H%M%S")O=tonumber(O)local date=date("%Y-%m-%d")local b=GetZoneText()global_startTime=N;global_raid=b;if not WebDKP_RaidInfo then WebDKP_RaidInfo={}end;if not WebDKP_CharRaidInfo then WebDKP_CharRaidInfo={}end;if not WebDKP_RaidInfo[b.." "..N]then WebDKP_RaidInfo[b.." "..N]={}end;WebDKP_RaidInfo[b.." "..N]["raid"]=b;WebDKP_RaidInfo[b.." "..N]["date"]=date;WebDKP_RaidInfo[b.." "..N]["starttime"]=M;WebDKP_RaidInfo[b.." "..N]["endtime"]=""WebDKP_RaidInfo[b.." "..N]["totaltime"]=""WebDKP_RaidInfo[b.." "..N]["attended"]={}WebDKP_RaidInfo[b.." "..N]["completedate"]=O;if WebDKP_CharRaidInfo~=nil then local P=getn(WebDKP_CharRaidInfo)for k,l in pairs(WebDKP_CharRaidInfo)do charname=k;WebDKP_CharRaidInfo[charname]["total_raids"]=WebDKP_CharRaidInfo[charname]["total_raids"]+1;tinsert(WebDKP_CharRaidInfo[charname]["attended"],"0&"..b.."&"..N)end end;WebDKP_UpdatePlayersInGroup()for k,l in pairs(WebDKP_PlayersInGroup)do name=l["name"]if WebDKP_CharRaidInfo[name]==nil then WebDKP_CharRaidInfo[name]={}WebDKP_CharRaidInfo[name]["total_raids"]=1;WebDKP_CharRaidInfo[name]["raids_attended"]=1;WebDKP_CharRaidInfo[name]["percent"]=100;WebDKP_CharRaidInfo[name]["attended"]={}tinsert(WebDKP_CharRaidInfo[name]["attended"],"1&"..b.."&"..N)else WebDKP_CharRaidInfo[name]["raids_attended"]=WebDKP_CharRaidInfo[name]["raids_attended"]+1;local Q=getn(WebDKP_CharRaidInfo[name]["attended"])for q=1,Q,1 do if WebDKP_CharRaidInfo[name]["attended"][q]=="0&"..b.."&"..N then WebDKP_CharRaidInfo[name]["attended"][q]="1&"..b.."&"..N end end end;tinsert(WebDKP_RaidInfo[b.." "..N]["attended"],l["name"])end;WebDKP_UpdateRaidLogTable()if WebDKP_CharRaidInfo~=nil then for k,l in pairs(WebDKP_CharRaidInfo)do charname1=k;WebDKP_CharRaidInfo[charname1]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charname1]["raids_attended"]/WebDKP_CharRaidInfo[charname1]["total_raids"]*100,0)end end end;function WebDKP_RaidEnd()if global_startTime~=""and global_raid~=""then local R=date("%H:%M:%S")local S="(%d%d):(%d%d):(%d%d)"_,_,hoursa,minutesa,secondsa=string.find(R,S)_,_,hoursb,minutesb,secondsb=string.find(global_startTime,S)local T=hoursa-hoursb;if T<0 then T=24+T end;local U=60-minutesb+minutesa;if U>=60 then U=U-60 end;if U<10 then U=strjoin("","0",U)end;local e=strjoin(":",T,U)totaltimeraid=e;if WebDKP_RaidInfo[global_raid.." "..global_startTime]then WebDKP_RaidInfo[global_raid.." "..global_startTime]["endtime"]=R;WebDKP_RaidInfo[global_raid.." "..global_startTime]["totaltime"]=totaltimeraid end;global_startTime=""gloabl_raid=""WebDKP_UpdateRaidLogTable()end end;function WebDKP_ScrollRaidLogListToggle()WebDKP_UpdateRaidLogTable()if WebDKP_RaidInfo~=nil then if global_startTime~=""and global_raid~=""then WebDKP_RaidInfo[global_raid.." "..global_startTime]["selected"]=false end;if _G["LineLocation"]~=""then _G["LineLocation"]:SetVertexColor(0,0,0,0)end end end;function WebDKP_ScrollLogAttendedToggle()WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end;function WebDKP_ScrollCharRaidLogListToggle()WebDKP_UpdateCharRaidLogTable()end;function WebDKP_ScrollAttendedRaidToggle()WebDKP_UpdateCharAttendedTable(previous_name)end;function WebDKP_DeleteRaid()if previous_raid~=""and previous_starttime~=""then if WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]~=nil then if WebDKP_CharRaidInfo~=nil then for k,l in pairs(WebDKP_CharRaidInfo)do charname=k;local P=getn(WebDKP_CharRaidInfo[charname]["attended"])for q=1,P,1 do if WebDKP_CharRaidInfo[charname]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime or WebDKP_CharRaidInfo[charname]["attended"][q]=="0&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[charname]["total_raids"]=WebDKP_CharRaidInfo[charname]["total_raids"]-1 end end;WebDKP_CharRaidInfo[charname]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charname]["raids_attended"]/WebDKP_CharRaidInfo[charname]["total_raids"]*100,0)end end;getcharentries=getn(WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"])for q=1,getcharentries,1 do charsname=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"][q]if WebDKP_CharRaidInfo[charsname]~=nil then getentriesrem=getn(WebDKP_CharRaidInfo[charsname]["attended"])for q=1,getentriesrem,1 do if WebDKP_CharRaidInfo[charsname]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[charsname]["attended"][q]="0&"..previous_raid.."&"..previous_starttime end end;WebDKP_CharRaidInfo[charsname]["raids_attended"]=WebDKP_CharRaidInfo[charsname]["raids_attended"]-1 end;WebDKP_CharRaidInfo[charsname]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[charsname]["raids_attended"]/WebDKP_CharRaidInfo[charsname]["total_raids"]*100,0)end;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]=nil;_G["LineLocation"]:SetVertexColor(0,0,0,0)_G["LineLocation"]=""previous_raid=""previous_starttime=""WebDKP_UpdateRaidLogTable()end;for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)r:Hide()end end end;function WebDKP_EndTime()local V=WebDKP_RaidInfoFrameEndTime:GetText()if V~=nil and V~=""then local W=tonumber(V)if W>0 then if previous_raid~=""and previous_starttime~=""then if WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]~=nil then local S="(%d%d):(%d%d):(%d%d)"local X="(%d+).(%d+)"local Y,Z=string.find(V,"%.")if Y==1 then V=strjoin("","0",V)end;if Y==nil then V=strjoin(".",V,"0")end;_,_,hours,minutes=string.find(V,X)minutes=strjoin("",".",minutes)minutes=tonumber(minutes)minutes=60*minutes;_,_,hoursb,minutesb,secondsb=string.find(previous_starttime,S)hoursb=hoursb+hours;minutesb=minutesb+minutes;if minutesb>59 then hoursb=hoursb+1;minutesb=minutesb-60 end;if minutesb<10 then minutesb=strjoin("","0",minutesb)end;local a0="00"if minutes<10 then minutes=strjoin("","0",minutes)end;local e=strjoin(":",hours,minutes)totaltimeraid=e;local a1=strjoin(":",hoursb,minutesb,a0)endraid=a1;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["totaltime"]=totaltimeraid;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["endtime"]=endraid;_G["LineLocation"]:SetVertexColor(0,0,0,0)_G["LineLocation"]=""previous_raid=""previous_starttime=""WebDKP_UpdateRaidLogTable()end end end end end;function WebDKP_DeleteAttendee()local a2=WebDKP_RaidInfoFrameCharChange:GetText()if previous_raid~=""and previous_starttime~=""and a2~=nil and a2~=""then name_entries=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]local o=getn(name_entries)for q=1,o,1 do if name_entries[q]==a2 then local a3=name_entries[q]local Q=getn(WebDKP_CharRaidInfo[a3]["attended"])for q=1,Q,1 do if WebDKP_CharRaidInfo[a3]["attended"][q]=="1&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[a3]["attended"][q]="0&"..previous_raid.."&"..previous_starttime end end;WebDKP_CharRaidInfo[a3]["raids_attended"]=WebDKP_CharRaidInfo[a3]["raids_attended"]-1;WebDKP_CharRaidInfo[a3]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[a3]["raids_attended"]/WebDKP_CharRaidInfo[a3]["total_raids"]*100,0)table.remove(name_entries,q)end end;WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]=name_entries;WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end end;function WebDKP_RemAttendee()WebDKP_CharRaidInfo[previous_name]=nil;WebDKP_UpdateCharRaidLogTable()for q=1,25,1 do local r=getglobal("WebDKP_RaidInfoFrameLines"..q)r:Hide()end;previous_name=""end;function WebDKP_AddAttendee()local a4=WebDKP_RaidInfoFrameCharChange:GetText()local a5=0;local a6=0;if WebDKP_CharRaidInfo[a4]~=nil then local a7=WebDKP_CharRaidInfo[a4]["attended"][1]_,charfirstraiddate=strsplit("&",a7)else charfirstraiddate=0 end;if previous_raid~=""and previous_starttime~=""and a4~=nil and a4~=""then name_entries=WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]local o=getn(name_entries)for k,l in pairs(name_entries)do charname=l;if charname==a4 then a5=1 end end;if a5==0 then table.insert(name_entries,a4)WebDKP_RaidInfo[previous_raid.." "..previous_starttime]["attended"]=name_entries;if WebDKP_CharRaidInfo[a4]==nil then WebDKP_CharRaidInfo[a4]={}WebDKP_CharRaidInfo[a4]["raids_attended"]=1;WebDKP_CharRaidInfo[a4]["total_raids"]=1;WebDKP_CharRaidInfo[a4]["percent"]=100;WebDKP_CharRaidInfo[a4]["attended"]={}tinsert(WebDKP_CharRaidInfo[a4]["attended"],"1&"..previous_raid.."&"..previous_starttime)else WebDKP_CharRaidInfo[a4]["raids_attended"]=WebDKP_CharRaidInfo[a4]["raids_attended"]+1;local Q=getn(WebDKP_CharRaidInfo[a4]["attended"])for q=1,Q,1 do if WebDKP_CharRaidInfo[a4]["attended"][q]=="0&"..previous_raid.."&"..previous_starttime then WebDKP_CharRaidInfo[a4]["attended"][q]="1&"..previous_raid.."&"..previous_starttime;a6=1 end end;if a6==0 then WebDKP_CharRaidInfo[a4]["total_raids"]=WebDKP_CharRaidInfo[a4]["total_raids"]+1;tinsert(WebDKP_CharRaidInfo[a4]["attended"],"1&"..previous_raid.."&"..previous_starttime)end;WebDKP_CharRaidInfo[a4]["percent"]=WebDKP_ROUND(WebDKP_CharRaidInfo[a4]["raids_attended"]/WebDKP_CharRaidInfo[a4]["total_raids"]*100,0)end end;WebDKP_UpdateAttendedTable(previous_raid,previous_starttime)end end;function WebDKP_ApplyDateFilter(w)if w==nil or w==""then WebDKP_Print("Please enter an appropiate date to apply the filter. Ex: 11-20-2010")return nil else local S="(%d+)-(%d+)-(%d+)"_,_,month,day,year=string.find(w,S)if month~=nil and day~=nil and year~=nil then return month,day,year else WebDKP_Print("Please enter an appropiate date to apply the filter. Ex: 11-20-2010")return nil end end end;function WebDKP_ProcessCharAttendedRaids(month,day,year,charname)local a8=0;local a9=0;local aa=0;month=tonumber(month)day=tonumber(day)year=tonumber(year)local raidsattended=WebDKP_CharRaidInfo[charname]["attended"]local o=getn(raidsattended)for q=1,o,1 do local ab=1;local ac=raidsattended[q]local S="(%d+)&(.+)&(.+)"local _,_,ad,H,ae=string.find(ac,S)local af="(%d+)-(%d+)-(%d+) (.+)"local _,_,ag,ah,ai=string.find(ae,af)ag=tonumber(ag)ai=tonumber(ai)ah=tonumber(ah)if ag<year then ab=0 end;if ag==year and ah<month then ab=0 end;if ag==year and ah==month and ai<day then ab=0 end;if ab==1 then a8=a8+1;if ad=="1"then a9=a9+1 end end end;if a8~=0 then aa=WebDKP_ROUND(a9/a8*100,0)end;return a8,a9,aa end;function WebDKP_CrossCheckDate(c)local ab=1;local w=WebDKP_CharRaidInfoFrameFilterDate:GetText()local month,day,year=WebDKP_ApplyDateFilter(w)month=tonumber(month)day=tonumber(day)year=tonumber(year)local af="(%d+)-(%d+)-(%d+) (.+)"local _,_,ag,ah,ai=string.find(c,af)ag=tonumber(ag)ai=tonumber(ai)ah=tonumber(ah)if ag<year then ab=0 end;if ag==year and ah<month then ab=0 end;if ag==year and ah==month and ai<day then ab=0 end;if ab==1 then return true end;return false end

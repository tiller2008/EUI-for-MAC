WebDKP_ItemAward=WebDKP.translations.FORMAT_WEBDKP_ITEMAWARD;WebDKP_ItemAwardZeroSum=WebDKP.translations.FORMAT_WEBDKP_ITEMAWARDZEROSUM;WebDKP_DkpAwardAll=WebDKP.translations.FORMAT_WEBDKP_DKPAWARDALL;WebDKP_DkpAwardSome=WebDKP.translations.FORMAT_WEBDKP_DKPAWARDSOME;WebDKP_BidStart=WebDKP.translations.FORMAT_WEBDKP_BIDSTART.."$startingBid".."$instructions"WebDKP_BidEnd=WebDKP.translations.FORMAT_WEBDKP_BIDEND;WebDKP_BidEndSilent=WebDKP.translations.FORMAT_WEBDKP_BIDENDSILENT;WebDKP_RollEnd=WebDKP.translations.FORMAT_WEBDKP_ROLLEND;WebDKP_TimedAward=WebDKP.translations.FORMAT_WEBDKP_TIMEDAWARD;WebDKP_BossAwardNum=WebDKP.translations.FORMAT_WEBDKP_BOSSAWARDNUM;function WebDKP_GetTellLocation()local a=GetNumGroupMembers()local b=GetNumSubgroupMembers()if a>0 then return"RAID"elseif b>0 then return"PARTY"else return"NONE"end end;function WebDKP_AnnounceAwardItem(c,d,e)if WebDKP_Options["Announcements"]==0 then local f=WebDKP_GetTellLocation()c=c*-1;local g,g,h=WebDKP_GetItemInfo(d)local toSay=string.gsub(WebDKP_ItemAward,"$player",e)toSay=string.gsub(toSay,"$item",h)toSay=string.gsub(toSay,"$cost",c)WebDKP_SendAnnouncement(toSay,f)if WebDKP_WebOptions["ZeroSumEnabled"]==1 then local i=WebDKP_GetTableSize(WebDKP_PlayersInGroup)if i~=0 then local j=c/i;j=WebDKP_ROUND(j,2)local toSay=string.gsub(WebDKP_ItemAwardZeroSum,"$dkp",j)toSay=string.gsub(toSay,"$item",h)WebDKP_SendAnnouncement(toSay,f)end end end end;function WebDKP_AnnounceAward(dkp,k)if WebDKP_Options["Announcements"]==0 then local f=WebDKP_GetTellLocation()local l=WebDKP_AllGroupSelected()if l==true then local toSay=string.gsub(WebDKP_DkpAwardAll,"$dkp",dkp)toSay=string.gsub(toSay,"$reason",k)WebDKP_SendAnnouncement(toSay,f)else local toSay=string.gsub(WebDKP_DkpAwardSome,"$dkp",dkp)toSay=string.gsub(toSay,"$reason",k)WebDKP_SendAnnouncement(toSay,f)for m,n in pairs(WebDKP_DkpTable)do if type(n)=="table"then if n["Selected"]then WebDKP_SendWhisper(m,WebDKP.translations.FORMAT_WEBDKP_SENDWHISPER..dkp.." dkp")end end end end end end;function WebDKP_AnnounceBidStart(d,o,p)local f=WebDKP_GetTellLocation()startingBidvalue=p;if o==0 or o==nil or o==""or o=="0"then o=""else o="("..o.."秒)"end;local q;local g,g,h=WebDKP_GetItemInfo(d)if WebDKP_Options["BidFixedBidding"]==1 then q="如果要出价,就在团队/小队/私聊里输入：需求"else q="如果要出价,就在团队/小队/私聊里输入: 出价 分数 ".."(如: 出价 50)"end;local r=""if p>0 then r="拍卖起始分: "..p.." dkp。"end;local toSay=string.gsub(WebDKP_BidStart,"$item",d)toSay=string.gsub(toSay,"$time",o)toSay=string.gsub(toSay,"$startingBid",r)toSay=string.gsub(toSay,"$instructions",q)local s=WebDKP_Options["EditStartAnnounce"]if s~=""and s~=nil then if o==""then o="User Defined"end;if startingBidvalue==0 then startingBidvalue="No Starting Bid"end;s=string.gsub(s,"$item",h)s=string.gsub(s,"$time",o)s=string.gsub(s,"$bid",startingBidvalue)WebDKP_SendAnnouncement(s,f)else WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_AnnounceRollStart(d,o)local f=WebDKP_GetTellLocation()local t="Time remaining:"local toSay=nil;if o==0 or o==nil or o==""or o=="0"then o=""else o="("..o.."s)"end;if o==""then toSay=string.gsub("Roll点开始： $item. 请输入 /roll","$item",d)else toSay=string.gsub("Roll点开始： $item.请输入 /roll . 剩余时间: $time","$item",d)toSay=string.gsub(toSay,"$time",o)end;local g,g,h=WebDKP_GetItemInfo(d)local f=WebDKP_GetTellLocation()local s=WebDKP_Options["EditSRollAnnounce"]if s~=""and s~=nil then s=string.gsub(s,"$item",h)if o==0 or o==nil or o=="0"then o="Unknown"end;s=string.gsub(s,"$time",o)WebDKP_SendAnnouncement(s,f)else toSay=string.gsub(toSay,"$item",h)toSay=string.gsub(toSay,"$time",o)WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_AnnounceBidEnd(d,name,dkp,u)if name==nil or name==""then name="no one"dkp=0 end;local g,g,h=WebDKP_GetItemInfo(d)local f=WebDKP_GetTellLocation()if WebDKP_Options["SilentBidding"]==0 then toSay=string.gsub(WebDKP_BidEnd,"$item",WebDKP_bidItemLink)toSay=string.gsub(toSay,"$name",name)toSay=string.gsub(toSay,"$dkp",dkp)else toSay=string.gsub(WebDKP_BidEndSilent,"$item",WebDKP_bidItemLink)end;local s=WebDKP_Options["EditEndAnnounce"]if s~=""and s~=nil then s=string.gsub(s,"$item",h)s=string.gsub(s,"$name",name)s=string.gsub(s,"$dkp",dkp)s=string.gsub(s,"$totbid",u)WebDKP_SendAnnouncement(s,f)else WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_AnnounceRollEnd(d,name,dkp,v)highest_roller,high_roll=WebDKP_Bid_GetHighestRoll()local g,g,h=WebDKP_GetItemInfo(d)if highest_roller==nil or highest_roller==""then highest_roller="No one"high_roll=0 end;local g,g,h=WebDKP_GetItemInfo(d)local f=WebDKP_GetTellLocation()local s=WebDKP_Options["EditERollAnnounce"]if s~=""and s~=nil then s=string.gsub(s,"$item",h)s=string.gsub(s,"$name",highest_roller)s=string.gsub(s,"$roll",high_roll)s=string.gsub(s,"$totrol",v)WebDKP_SendAnnouncement(s,f)else local toSay=WebDKP_RollEnd;toSay=string.gsub(toSay,"$item",h)toSay=string.gsub(toSay,"$name",highest_roller)toSay=string.gsub(toSay,"$roll",high_roll)WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_AnnounceTimedAward(w,dkp)if WebDKP_Options["Announcements"]==0 then local f=WebDKP_GetTellLocation()local toSay=string.gsub(WebDKP_TimedAward,"$minutes",w)toSay=string.gsub(toSay,"$dkp",dkp)WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_AnnounceBossAward(dkp,x)if WebDKP_Options["Announcements"]==0 then local f=WebDKP_GetTellLocation()local toSay=string.gsub(WebDKP_BossAwardNum,"$dkp",dkp)toSay=string.gsub(toSay,"$boss",x)WebDKP_SendAnnouncement(toSay,f)end end;function WebDKP_SendAnnouncement(toSay,y)if y=="NONE"then WebDKP_Print(toSay)else local z=string.find(toSay,"\n")local A;local B=0;while z~=nil do A=string.sub(toSay,0,z-1)SendChatMessage(A,y)toSay=string.sub(toSay,z+1,string.len(toSay))z=string.find(toSay,"\n")end;SendChatMessage(toSay,y)end end;function WebDKP_SendAnnouncementDefault(toSay)local f=WebDKP_GetTellLocation()WebDKP_SendAnnouncement(toSay,f)end;function WebDKP_AnnounceTop3()local f=WebDKP_GetTellLocation()local C,D,E,F,G,H=WebDKP_Bid_GetTopThree()if C==nil or C==""then C="NA"F=0 end;if D==nil or D==""then D="NA"G=0 end;if E==nil or E==""then E="NA"H=0 end;if WebDKP_Options["SilentBidding"]==0 then toSay=string.gsub(WebDKP_BidEnd,"$item",WebDKP_bidItemLink)toSay=string.gsub(toSay,"$name",name)toSay=string.gsub(toSay,"$dkp",dkp)else toSay=string.gsub(WebDKP_BidEndSilent,"$item",WebDKP_bidItemLink)end;local s="WebDKP: 前三名的竞拍者是:"WebDKP_SendAnnouncement(s,f)WebDKP_SendAnnouncement("1. "..C.." 出价: "..F,f)WebDKP_SendAnnouncement("2. "..D.." 出价: "..G,f)WebDKP_SendAnnouncement("3. "..E.." 出价: "..H,f)end

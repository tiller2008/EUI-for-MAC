function WebDKP_BossAward_PerformAward(a,b,c)if WebDKP_Options["AwardBossDKP"]==1 then ZoneName=GetRealZoneText()if ZoneName=="Blackwing Descent"and c=="Onyxia"then return end;if b=="UNIT_DIED"then local d=WebDKP.translations.BOSS_KILL_LIST[c]if d~=nil then WebDKP_AwardDKP(d)return end end;local e=WebDKP_Check_Council_Fights(c)if e~=nil then WebDKP_AwardDKP(e)return end;local f=WebDKP.translations.BOSS_YELL_LIST[b]if f~=nil then local g=f[a]if g~=nil then WebDKP_AwardDKP(g)end end end end;function WebDKP_AwardDKP(h)local i=WebDKP.translations.BOSS_MAP[GetRealZoneText()]if i~=nil then local j=tonumber(WebDKP_Options[i])if j==0 then WebDKP_Print(string.format("%s:%s 自动击杀增加的dkp为0，已忽略",GetRealZoneText(),h))do return end end;WebDKP_UpdatePlayersInGroup()for k,l in pairs(WebDKP_WebOptions)do s=SG~=nil and SG==l or next(WebDKP_Tables)==nil;if s then break end end;if not s then return end;WebDKP_AddDKP(j,"自动Boss击杀奖励: "..h,"false",WebDKP_PlayersInGroup)WebDKP_AnnounceBossAward(j,h)WebDKP_Refresh()end end;function WebDKP_TimedAward_ToggleUI()if WebDKP_TimedAwardFrame:IsShown()then WebDKP_TimedAwardFrame:Hide()else WebDKP_TimedAwardFrame:Show()local m=WebDKP_TimedAwardFrameTime:GetText()if m==nil or m==""then WebDKP_TimedAwardFrameTime:SetText("5")end;local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then WebDKP_TimedAwardFrameDkp:SetText("0")end end end;function WebDKP_TimedAward_ToggleMiniTimer()if WebDKP_TimedAward_MiniFrame:IsShown()then WebDKP_TimedAward_MiniFrame:Hide()WebDKP_Options["TimedAwardMiniTimer"]=0 else WebDKP_TimedAward_MiniFrame:Show()WebDKP_Options["TimedAwardMiniTimer"]=1 end end;function WebDKP_TimedAward_ShowUI()WebDKP_TimedAwardFrame:Show()local m=WebDKP_TimedAwardFrameTime:GetText()if m==nil or m==""then WebDKP_TimedAwardFrameTime:SetText("0")end;local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then WebDKP_TimedAwardFrameTime:SetText("0")end end;function WebDKP_TimedAward_HideUI()WebDKP_TimedAwardFrame:Hide()end;function WebDKP_TimedAward_ToggleTimer()if WebDKP_Options["TimedAwardInProgress"]==true then WebDKP_Options["TimedAwardInProgress"]=false;WebDKP_TimedAwardFrameStartStopButton:SetText("开始")WebDKP_TimedAward_UpdateFrame:Hide()WebDKP_TimedAward_UpdateText()else WebDKP_Options["TimedAwardInProgress"]=true;if WebDKP_Options["TimedAwardTimer"]==0 then local m=WebDKP_TimedAwardFrameTime:GetText()if m==nil or m==""then m=5 end;WebDKP_Options["TimedAwardTimer"]=m*60 end;WebDKP_TimedAwardFrameStartStopButton:SetText("停止")WebDKP_TimedAward_UpdateFrame:Show()WebDKP_TimedAward_UpdateText()end end;function WebDKP_TimedAward_ResetTimer()local m=WebDKP_TimedAwardFrameTime:GetText()if m==nil or m==""then m=5 end;WebDKP_Options["TimedAwardTimer"]=m*60;WebDKP_TimedAward_UpdateText()end;function WebDKP_TimedAward_OnUpdate(self,n)local o=self;o.TimeSinceLastUpdate=o.TimeSinceLastUpdate+n;if o.TimeSinceLastUpdate>1.0 then o.TimeSinceLastUpdate=0;WebDKP_Options["TimedAwardTimer"]=WebDKP_Options["TimedAwardTimer"]-1;WebDKP_TimedAward_UpdateText()if WebDKP_Options["TimedAwardTimer"]<=0 then WebDKP_TimedAward_PerformAward()if WebDKP_Options["TimedAwardRepeat"]==1 then WebDKP_TimedAward_ResetTimer()else WebDKP_Options["TimedAwardInProgress"]=false;WebDKP_TimedAwardFrameStartStopButton:SetText("开始")WebDKP_TimedAward_UpdateFrame:Hide()end end end end;function WebDKP_TimedAward_UpdateText()local p=""local q=floor(WebDKP_Options["TimedAwardTimer"]/60)local r=WebDKP_Options["TimedAwardTimer"]%60;if q>0 then p=p..q..":"end;if r<10 then r="0"..r end;p=p..r;WebDKP_TimedAwardFrameTimeLeft:SetText("剩余时间: "..p)WebDKP_TimedAward_MiniFrameTimeLeft:SetText(p)end;function WebDKP_TimedAward_PerformAward()WebDKP_UpdatePlayersInGroup()local t=WebDKP_PlayersInGroup;local u=WebDKP_GetTableSize(WebDKP_PlayersInGroup)local j=WebDKP_TimedAwardFrameDkp:GetText()if j==nil or j==""then j=0 end;j=tonumber(j)if WebDKP_Options["TimedStandby"]==1 then for v,l in pairs(WebDKP_DkpTable)do if type(l)=="table"then local w=v;local x=l["class"]local y=l["standby"]if y~=nil and y==1 then u=u+1;t[u]={["name"]=w,["class"]=x}end end end end;if WebDKP_Options["EPGPEnabled"]==1 then WebDKP_AddEP(j,"时间分自动奖励","false",WebDKP_PlayersInGroup)WebDKP_UpdateTableToShow()WebDKP_UpdateEPGPTable()else WebDKP_AddDKP(j,"时间分自动奖励","false",WebDKP_PlayersInGroup)WebDKP_UpdateTableToShow()WebDKP_UpdateTable()end;WebDKP_AnnounceTimedAward(WebDKP_TimedAwardFrameTime:GetText(),j)WebDKP_Refresh()end;function WebDKP_Check_Council_Fights(h)local z=nil;if h=="Than Kor'Thazz"and _G["KorFlag"]==1 then _G["RivendareFlag"]=0;_G["LadyFlag"]=0;_G["SirFlag"]=0 end;if(h=="Baron Rivendare"and _G["RivendareFlag"])==1 then _G["KorFlag"]=0;_G["LadyFlag"]=0;_G["SirFlag"]=0 end;if(h=="Lady Blaumeux"and _G["LadyFlag"])==1 then _G["KorFlag"]=0;_G["RivendareFlag"]=0;_G["SirFlag"]=0 end;if(h=="Sir Zeliek"and _G["SirFlag"])==1 then _G["KorFlag"]=0;_G["RivendareFlag"]=0;_G["LadyFlag"]=0 end;if h=="Than Kor'Thazz"then _G["KorFlag"]=1 end;if h=="Baron Rivendare"then _G["RivendareFlag"]=1 end;if h=="Lady Blaumeux"then _G["LadyFlag"]=1 end;if h=="Sir Zeliek"then _G["SirFlag"]=1 end;if _G["KorFlag"]+_G["RivendareFlag"]+_G["LadyFlag"]+_G["SirFlag"]==3 then z="Four Horsemen"_G["KorFlag"]=0;_G["RivendareFlag"]=0;_G["LadyFlag"]=0;_G["SirFlag"]=0 end;if h=="Earthbreaker Haromm"then _G["Earthbreaker"]=1 end;if h=="Wavebinder Kardris"then _G["WaveBinder"]=1 end;if _G["Earthbreaker"]+_G["WaveBinder"]==2 then z="Kor'kron Dark Shaman"_G["Earthbreaker"]=0;_G["WaveBinder"]=0 end;return z end
